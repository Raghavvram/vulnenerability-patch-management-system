Metadata-Version: 2.4
Name: vulnpm
Version: 0.1.0
Summary: Vulnerability patch management toolkit
Requires-Python: >=3.10
Description-Content-Type: text/markdown

# Vulnerability Patch Management System

## Overview
This project is a modular vulnerability management toolkit. It automates the workflow from vulnerability scanning to patch prioritization using Nmap parsing, enrichment, LLM analysis, and prioritization â€” now exposed as direct Python functions (no HTTP endpoints).

## Architecture
- **main_orchestrator**: Provides `process_scan(xml_content: str)` to run the full pipeline.
- **parser_service**: Provides `parse_nmap_xml(xml_content: str)`.
- **enricher_service**: Provides `await enrich_hosts(hosts: list[dict])`.
- **llm_service**: Provides `await analyze_enriched_hosts(enriched_hosts: list[dict])`.
- **prioritization_engine**: Provides `await prioritize_analyzed_hosts(analyzed_hosts: list[dict])`.

## Quick Start
1. **Clone the repository**
2. **Install Python deps (optional virtualenv recommended):**
   ```
   uv pip install -r requirements.txt
   ```
3. **Call the orchestrator directly in Python:**
   ```python
   import asyncio
   from services.main_orchestrator.main import process_scan

   xml = "<nmaprun>...</nmaprun>"
   result = asyncio.run(process_scan(xml))
   print(result)
   ```

## CLI Usage
- You can also run via CLI after placing your Nmap XML on disk and `.env` with `PERPLEXITY_API_KEY`:
  ```
  uv run python cli.py --xml examples/scan.xml
  ```

## Dashboard (Streamlit)
- Start the dashboard and upload your `scan.xml` to get a beautiful breakdown (charts, tables, CVE scatter):
  ```
  uv run streamlit run app/dashboard.py
  ```
- Features:
  - Upload Nmap XML
  - Parse-only or full pipeline (enrichment, LLM, prioritization)
  - Visual summaries:
    - Treemap: Vulnerabilities by Host > Service > Port
    - Bar chart: Service priority counts
    - CVE scatter: CVSS vs EPSS with hover details
  - Detailed service table and Top CVEs
  - Raw JSON output for debugging

## Configuration
- Create `.env` with:
  - `PERPLEXITY_API_KEY`: optional; if absent, LLM falls back to rule-based.
  - `NVD_API_KEY`: optional; improves NVD rate limits.
  - `LOG_LEVEL`: default `INFO`.

## Notes
- HTTP endpoints were removed in favor of direct function calls for simplicity and testability.
- If you previously used Docker services and dashboards, you can still use the database schema and monitoring assets, but they are optional now.

## Customization
- Edit `docker-compose.yml` to change service ports, add integrations, or adjust resource limits.
- Environment variables are set in `.env` (auto-generated by the deploy script).

## Troubleshooting
- Check container logs with:
  ```
  docker logs <container_name>
  ```
- If a service is unhealthy, restart it:
  ```
  docker restart <container_name>
  ```
- For API errors, see logs in the respective service folder.

## Advanced Usage
- Integrate with your own Nmap scans by updating the XML in `test_nmap_scan_and_submit.sh`.
- Extend enrichment, LLM, or ML logic by editing the respective Python service code.

## License
MIT
